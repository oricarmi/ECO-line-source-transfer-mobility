<!DOCTYPE html>
<html>
<head>
    <title>Data Preview - Vibration Impact Analysis</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Data Preview</h1>
    <p>Review the data below and specify which impacts to remove before analysis.</p>
    
    <h2>Force and Vibration Measurements</h2>
    {{ plots.combined_preview | safe }}
    
    <h2>Impact Times</h2>
    <p>Current impact times: 
        {% for time in impact_times %}
            Impact {{ loop.index }}: {{ time }}s{% if not loop.last %}, {% endif %}
        {% endfor %}
    </p>
    
    <form action="/analyze" method="post" enctype="multipart/form-data">
        <h3>Select Impacts to Remove by Channel</h3>
        {% for i in range(channel_count) %}
        <label for="impacts_to_remove_ch{{ i }}">Channel {{ i + channel_offset }} - Impacts to remove (comma-separated impact numbers, e.g., 1,3,5):</label><br>
        <input type="text" id="impacts_to_remove_ch{{ i }}" name="impacts_to_remove_ch{{ i }}" placeholder="e.g., 1,3,5 or leave empty"><br><br>
        {% endfor %}
        
        <!-- Hidden fields to pass session data -->
        <input type="hidden" name="force_csv_path" value="{{ session_data.force_csv_path }}">
        <input type="hidden" name="vibration_csv_paths" value="{{ session_data.vibration_csv_paths | join(',') }}">
        <input type="hidden" name="receivers_data_excel_path" value="{{ session_data.receivers_data_excel_path or '' }}">
        <input type="hidden" name="channel_distances_list" value="{{ session_data.channel_distances_list | join(',') }}">
        <input type="hidden" name="impact_times_list" value="{{ session_data.impact_times_list | join(',') }}">
        <input type="hidden" name="receiver_distances_list" value="{{ session_data.receiver_distances_list | join(',') }}">
        <input type="hidden" name="train_length" value="{{ session_data.train_length }}">
        <input type="hidden" name="source_depth" value="{{ session_data.source_depth }}">
        <input type="hidden" name="save_path" value="{{ session_data.save_path }}">
        <input type="hidden" name="units" value="{{ session_data.units }}">
        <input type="hidden" name="fds_csv_path" value="{{ session_data.fds_csv_path or '' }}">
        <input type="hidden" name="floor_resonance_frequencies" value="{{ session_data.floor_resonance_frequencies or '' }}">
        <input type="hidden" name="db_amount" value="{{ session_data.db_amount or '' }}">
        
        <input type="submit" value="Proceed with Analysis">
    </form>
</body>
</html>
